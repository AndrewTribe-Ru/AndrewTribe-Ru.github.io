import{u as Y,r as i,d as S,J as Z,e as c,f as g,g as l,a3 as O,h as t,i as a,aR as f,aS as p,aT as P,q as Q,t as d,m as $,Q as B,j as D,l as G,n as k,s as h,L as z}from"./index.acaefd83.js";import{u as ee,Q as ae,a as te,b as le,c as se,V as M,v as re,L as C}from"./QItemLabel.0d5197b8.js";import{_ as ne,Q as oe}from"./QExpansionItem.600a530a.js";const ie={class:"text-body1 text-negative q-mb-sm"},ue={class:"q-gutter-y-md column"},de={class:"text-caption"},me={class:"q-mt-md"},ve={class:"q-mt-sm"},ce={class:"debug-pre"},ge={__name:"AuthTelegram",setup(fe){const y=ee(),{$t:m}=Y(),R=i(!0),E=i(!1),v=i(""),n=i(null),u=i(""),x=i(""),b=i(""),_=i(""),w=i(""),I=i(!1),q=i(!1),K=S(()=>typeof window=="undefined"?!1:!!(window.Telegram&&window.Telegram.WebApp)),J=S(()=>u.value?u.value.length>200?u.value.slice(0,200)+"...":u.value:""),N=S(()=>{if(!n.value)return"";const{username:o,first_name:e,last_name:s,id:r}=n.value;return o?`@${o} (ID: ${r})`:e||s?`${e||""} ${s||""} (ID: ${r})`.trim():`ID: ${r}`}),V=()=>x.value.trim()?(_.value="",!0):(_.value=m(M.ID_REQUIRED),!1),W=()=>b.value.trim()?(w.value="",!0):(w.value=m(M.PASSWORD_REQUIRED),!1),j=async()=>{var o,e;try{if(typeof window=="undefined"){v.value="\uBE0C\uB77C\uC6B0\uC800 \uD658\uACBD\uC5D0\uC11C\uB9CC \uC811\uADFC \uAC00\uB2A5\uD569\uB2C8\uB2E4.";return}const s=window.Telegram&&window.Telegram.WebApp;if(!s){v.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uAC00 \uAC10\uC9C0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uC774 \uD398\uC774\uC9C0\uB97C \uB2E4\uC2DC \uC5F4\uC5B4\uC8FC\uC138\uC694.";return}try{s.ready()}catch{}if(u.value=s.initData||"",n.value=((o=s.initDataUnsafe)==null?void 0:o.user)||null,!u.value||!((e=n.value)!=null&&e.id)){v.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC815\uBCF4\uAC00 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.";return}try{const r=await O.post("/api/v1/telegram/verify",{initData:u.value});window.alert(JSON.stringify(r.data))}catch{v.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC11C\uBC84\uC640 \uD1B5\uC2E0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",window.alert(`Telegram initData \uAC80\uC99D \uC911 \uC11C\uBC84 \uC624\uB958

message: ${v.value}`)}}finally{R.value=!1}},A=async()=>{var s,r,U,L;if(!E.value||!n.value){y.notify({type:"negative",message:"\uD154\uB808\uADF8\uB7A8 \uC778\uC99D\uC774 \uC644\uB8CC\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."});return}const o=V(),e=W();if(!(!o||!e)){if(!re(x.value,b.value)){y.notify({type:"negative",message:m(C.ID_PW_REQUIRED)});return}I.value=!0;try{const T=await O.post("/api/v1/telegram/link",{mbrId:x.value,mbrPw:b.value,telegramUserId:n.value.id,username:n.value.username,firstName:n.value.first_name,lastName:n.value.last_name,initData:u.value}),H=Number((r=(s=T.data)==null?void 0:s.code)!=null?r:0);if(!(((U=T.data)==null?void 0:U.success)===!0||H===200)){const X=((L=T.data)==null?void 0:L.message)||m(C.ID_PW_INCORRECT);y.notify({type:"negative",message:X});return}y.notify({type:"positive",message:"\uD154\uB808\uADF8\uB7A8 \uACC4\uC815\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC5F0\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),q.value=!0}catch{y.notify({type:"negative",message:m(C.SERVER_CONNECTION_FAILED)})}finally{I.value=!1}}},F=()=>{var o;try{typeof window!="undefined"&&((o=window.Telegram)==null?void 0:o.WebApp)?window.Telegram.WebApp.close():window.close()}catch{window.close()}};return Z(()=>{j()}),(o,e)=>(c(),g(ae,null,{default:l(()=>[t(se,null,{default:l(()=>[t(te,{class:"q-pa-xl flex flex-center"},{default:l(()=>[e[14]||(e[14]=a("section",{class:"q-mb-lg text-center"},[a("div",{class:"text-h5 text-primary q-mb-xs"},"Telegram \uC778\uC99D"),a("div",{class:"text-subtitle2 text-grey-7"}," \uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uC0AC\uC6A9\uD560 \uC218 \uC788\uB294 \uACC4\uC815 \uC5F0\uB3D9 \uD398\uC774\uC9C0\uC785\uB2C8\uB2E4. ")],-1)),t(f,null,{default:l(()=>[t(p,{class:"flex flex-center column q-pa-xl"},{default:l(()=>[t(P,{color:"primary",size:"32px",class:"q-mb-md"}),e[2]||(e[2]=a("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778\uD558\uAE30 ",-1)),e[3]||(e[3]=a("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})]),_:1}),R.value?(c(),g(f,{key:0,flat:"",bordered:""},{default:l(()=>[t(p,{class:"flex flex-center column q-pa-xl"},{default:l(()=>[t(P,{color:"primary",size:"32px",class:"q-mb-md"}),e[4]||(e[4]=a("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778 \uC911\uC785\uB2C8\uB2E4... ",-1)),e[5]||(e[5]=a("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})]),_:1})):!E.value&&!q.value?(c(),g(f,{key:1,flat:"",bordered:"",class:"bg-grey-1"},{default:l(()=>[t(p,{class:"flex column items-center q-pa-xl"},{default:l(()=>[t(Q,{name:"warning",color:"negative",size:"40px",class:"q-mb-md"}),a("div",ie,d(v.value),1),e[6]||(e[6]=a("div",{class:"text-caption text-grey-7 q-mb-md text-center"}," \uC774 \uD398\uC774\uC9C0\uB294 \uD154\uB808\uADF8\uB7A8 \uBD07\uC5D0\uC11C \uC5F4\uB9AC\uB294 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uB3D9\uC791\uD569\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694. ",-1))]),_:1})]),_:1})):q.value?(c(),g(f,{key:2,flat:"",bordered:""},{default:l(()=>[t(p,{class:"flex column items-center q-pa-xl"},{default:l(()=>[t(Q,{name:"check_circle",color:"positive",size:"40px",class:"q-mb-md"}),e[7]||(e[7]=a("div",{class:"text-h6 q-mb-sm"},"\uD154\uB808\uADF8\uB7A8 \uC5F0\uB3D9\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.",-1)),e[8]||(e[8]=a("div",{class:"text-body2 text-grey-7 q-mb-md text-center"}," \uC774\uC81C \uC774 \uACC4\uC815\uC73C\uB85C \uB85C\uADF8\uC778\uD560 \uB54C \uD154\uB808\uADF8\uB7A8\uC744 \uD1B5\uD574 2\uB2E8\uACC4 \uC778\uC99D \uCF54\uB4DC\uB97C \uBC1B\uC73C\uC2E4 \uC218 \uC788\uC2B5\uB2C8\uB2E4. ",-1)),t($,{color:"primary",unelevated:"",label:"\uB2EB\uAE30",onClick:F})]),_:1})]),_:1})):(c(),g(f,{key:3,flat:"",bordered:""},{default:l(()=>[t(p,{class:"q-pa-lg"},{default:l(()=>[e[11]||(e[11]=a("div",{class:"text-subtitle1 q-mb-xs"},"\uACC4\uC815 \uD655\uC778",-1)),e[12]||(e[12]=a("div",{class:"text-caption text-grey-7 q-mb-md"}," \uD154\uB808\uADF8\uB7A8\uC5D0 \uC5F0\uB3D9\uD560 \uACC4\uC815\uC758 ID\uC640 \uBE44\uBC00\uBC88\uD638\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694. ",-1)),a("div",ue,[t(B,{label:D(m)(D(z).ID),filled:"",modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=s=>x.value=s),onBlur:V,onKeyup:G(A,["enter"]),error:!!_.value,"error-message":_.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),t(B,{label:D(m)(D(z).PASSWORD),filled:"",modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),type:"password",onBlur:W,onKeyup:G(A,["enter"]),error:!!w.value,"error-message":w.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),N.value?(c(),g(le,{key:0,rounded:"",dense:"",class:"bg-grey-2 text-grey-8 q-mt-sm"},{avatar:l(()=>[t(Q,{name:"telegram",color:"primary"})]),default:l(()=>[a("div",de,[e[9]||(e[9]=k(" \uC5F0\uACB0\uD560 \uD154\uB808\uADF8\uB7A8 \uACC4\uC815: ")),a("strong",null,d(N.value),1)])]),_:1})):h("",!0),t($,{color:"primary",unelevated:"",class:"q-mt-md",loading:I.value,disable:I.value,onClick:A},{default:l(()=>e[10]||(e[10]=[k(" \uD154\uB808\uADF8\uB7A8 \uACC4\uC815 \uC5F0\uB3D9 ")])),_:1},8,["loading","disable"])])]),_:1})]),_:1})),a("div",me,[t(oe,{dense:"","expand-separator":"",icon:"bug_report",label:"Telegram Debug Info (\uAC1C\uBC1C \uC804\uC6A9)","header-class":"bg-grey-3 text-grey-9"},{default:l(()=>[t(f,null,{default:l(()=>[t(p,{class:"text-caption bg-grey-10 text-grey-2"},{default:l(()=>{var s,r;return[a("div",null,"has Telegram.WebApp: "+d(K.value),1),a("div",null,"isTelegramReady: "+d(E.value),1),a("div",null,"linkCompleted: "+d(q.value),1),a("div",null,"initData length: "+d(u.value||0),1),a("div",null,"telegramUser.id: "+d(((s=n.value)==null?void 0:s.id)||"null"),1),a("div",null," telegramUser.username: "+d(((r=n.value)==null?void 0:r.username)||"null"),1),a("div",ve,[e[13]||(e[13]=k(" initData (\uC55E\uBD80\uBD84\uB9CC \uD45C\uC2DC): ")),a("pre",ce,d(J.value),1)])]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}))}};var _e=ne(ge,[["__scopeId","data-v-7f792da3"]]);export{_e as default};
