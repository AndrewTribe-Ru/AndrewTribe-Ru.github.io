import{u as Y,r as i,d as k,J as Z,e as c,f,g as l,a3 as L,h as t,i as a,aR as p,aS as y,aT as O,q as C,t as d,m as P,Q as B,j as S,l as G,n as R,s as h,L as z}from"./index.70ab26dc.js";import{u as ee,Q as ae,a as te,b as le,c as se,V as M,v as re,L as N}from"./QItemLabel.3105f791.js";import{_ as ne,Q as oe}from"./QExpansionItem.2cea15ea.js";const ie={class:"text-body1 text-negative q-mb-sm"},ue={class:"q-gutter-y-md column"},de={class:"text-caption"},me={class:"q-mt-md"},ve={class:"q-mt-sm"},ge={class:"debug-pre"},ce={__name:"AuthTelegram",setup(fe){const x=ee(),{$t:v}=Y(),V=i(!0),I=i(!1),m=i(""),n=i(null),u=i(""),b=i(""),w=i(""),T=i(""),q=i(""),D=i(!1),E=i(!1),K=k(()=>typeof window=="undefined"?!1:!!(window.Telegram&&window.Telegram.WebApp)),J=k(()=>u.value?u.value.length>200?u.value.slice(0,200)+"...":u.value:""),$=k(()=>{if(!n.value)return"";const{username:o,first_name:e,last_name:s,id:r}=n.value;return o?`@${o} (ID: ${r})`:e||s?`${e||""} ${s||""} (ID: ${r})`.trim():`ID: ${r}`}),W=()=>b.value.trim()?(T.value="",!0):(T.value=v(M.ID_REQUIRED),!1),U=()=>w.value.trim()?(q.value="",!0):(q.value=v(M.PASSWORD_REQUIRED),!1),j=async()=>{var o,e;try{if(typeof window=="undefined"){m.value="\uBE0C\uB77C\uC6B0\uC800 \uD658\uACBD\uC5D0\uC11C\uB9CC \uC811\uADFC \uAC00\uB2A5\uD569\uB2C8\uB2E4.";return}const s=window.Telegram&&window.Telegram.WebApp;if(!s){m.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uAC00 \uAC10\uC9C0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uC774 \uD398\uC774\uC9C0\uB97C \uB2E4\uC2DC \uC5F4\uC5B4\uC8FC\uC138\uC694.";return}try{s.ready()}catch{}if(u.value=s.initData||"",n.value=((o=s.initDataUnsafe)==null?void 0:o.user)||null,!u.value||!((e=n.value)!=null&&e.id)){m.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC815\uBCF4\uAC00 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.";return}try{const r=await L.post("/api/v1/telegram/verify",{initData:u.value}),{valid:A,message:_,user:g}=r.data||{};if(window.alert(JSON.stringify(r.data)),A)I.value=!0,window.alert(`Telegram initData \uAC80\uC99D \uC131\uACF5

message: ${_||""}${g?`
user: ${g}`:""}`);else{m.value=_||"\uD154\uB808\uADF8\uB7A8 \uC778\uC99D\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uB098\uC911\uC5D0 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",window.alert(`Telegram initData \uAC80\uC99D \uC2E4\uD328

message: ${m.value}`);return}}catch{m.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC11C\uBC84\uC640 \uD1B5\uC2E0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",window.alert(`Telegram initData \uAC80\uC99D \uC911 \uC11C\uBC84 \uC624\uB958

message: ${m.value}`)}}finally{V.value=!1}},Q=async()=>{var s,r,A,_;if(!I.value||!n.value){x.notify({type:"negative",message:"\uD154\uB808\uADF8\uB7A8 \uC778\uC99D\uC774 \uC644\uB8CC\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."});return}const o=W(),e=U();if(!(!o||!e)){if(!re(b.value,w.value)){x.notify({type:"negative",message:v(N.ID_PW_REQUIRED)});return}D.value=!0;try{const g=await L.post("/api/v1/telegram/link",{mbrId:b.value,mbrPw:w.value,telegramUserId:n.value.id,username:n.value.username,firstName:n.value.first_name,lastName:n.value.last_name,initData:u.value}),H=Number((r=(s=g.data)==null?void 0:s.code)!=null?r:0);if(!(((A=g.data)==null?void 0:A.success)===!0||H===200)){const X=((_=g.data)==null?void 0:_.message)||v(N.ID_PW_INCORRECT);x.notify({type:"negative",message:X});return}x.notify({type:"positive",message:"\uD154\uB808\uADF8\uB7A8 \uACC4\uC815\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC5F0\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),E.value=!0}catch{x.notify({type:"negative",message:v(N.SERVER_CONNECTION_FAILED)})}finally{D.value=!1}}},F=()=>{var o;try{typeof window!="undefined"&&((o=window.Telegram)==null?void 0:o.WebApp)?window.Telegram.WebApp.close():window.close()}catch{window.close()}};return Z(()=>{j()}),(o,e)=>(c(),f(ae,null,{default:l(()=>[t(se,null,{default:l(()=>[t(te,{class:"q-pa-xl flex flex-center"},{default:l(()=>[e[14]||(e[14]=a("section",{class:"q-mb-lg text-center"},[a("div",{class:"text-h5 text-primary q-mb-xs"},"Telegram \uC778\uC99D"),a("div",{class:"text-subtitle2 text-grey-7"}," \uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uC0AC\uC6A9\uD560 \uC218 \uC788\uB294 \uACC4\uC815 \uC5F0\uB3D9 \uD398\uC774\uC9C0\uC785\uB2C8\uB2E4. ")],-1)),t(p,null,{default:l(()=>[t(y,{class:"flex flex-center column q-pa-xl"},{default:l(()=>[t(O,{color:"primary",size:"32px",class:"q-mb-md"}),e[2]||(e[2]=a("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778\uD558\uAE30 ",-1)),e[3]||(e[3]=a("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})]),_:1}),V.value?(c(),f(p,{key:0,flat:"",bordered:""},{default:l(()=>[t(y,{class:"flex flex-center column q-pa-xl"},{default:l(()=>[t(O,{color:"primary",size:"32px",class:"q-mb-md"}),e[4]||(e[4]=a("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778 \uC911\uC785\uB2C8\uB2E4... ",-1)),e[5]||(e[5]=a("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})]),_:1})):!I.value&&!E.value?(c(),f(p,{key:1,flat:"",bordered:"",class:"bg-grey-1"},{default:l(()=>[t(y,{class:"flex column items-center q-pa-xl"},{default:l(()=>[t(C,{name:"warning",color:"negative",size:"40px",class:"q-mb-md"}),a("div",ie,d(m.value),1),e[6]||(e[6]=a("div",{class:"text-caption text-grey-7 q-mb-md text-center"}," \uC774 \uD398\uC774\uC9C0\uB294 \uD154\uB808\uADF8\uB7A8 \uBD07\uC5D0\uC11C \uC5F4\uB9AC\uB294 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uB3D9\uC791\uD569\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694. ",-1))]),_:1})]),_:1})):E.value?(c(),f(p,{key:2,flat:"",bordered:""},{default:l(()=>[t(y,{class:"flex column items-center q-pa-xl"},{default:l(()=>[t(C,{name:"check_circle",color:"positive",size:"40px",class:"q-mb-md"}),e[7]||(e[7]=a("div",{class:"text-h6 q-mb-sm"},"\uD154\uB808\uADF8\uB7A8 \uC5F0\uB3D9\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.",-1)),e[8]||(e[8]=a("div",{class:"text-body2 text-grey-7 q-mb-md text-center"}," \uC774\uC81C \uC774 \uACC4\uC815\uC73C\uB85C \uB85C\uADF8\uC778\uD560 \uB54C \uD154\uB808\uADF8\uB7A8\uC744 \uD1B5\uD574 2\uB2E8\uACC4 \uC778\uC99D \uCF54\uB4DC\uB97C \uBC1B\uC73C\uC2E4 \uC218 \uC788\uC2B5\uB2C8\uB2E4. ",-1)),t(P,{color:"primary",unelevated:"",label:"\uB2EB\uAE30",onClick:F})]),_:1})]),_:1})):(c(),f(p,{key:3,flat:"",bordered:""},{default:l(()=>[t(y,{class:"q-pa-lg"},{default:l(()=>[e[11]||(e[11]=a("div",{class:"text-subtitle1 q-mb-xs"},"\uACC4\uC815 \uD655\uC778",-1)),e[12]||(e[12]=a("div",{class:"text-caption text-grey-7 q-mb-md"}," \uD154\uB808\uADF8\uB7A8\uC5D0 \uC5F0\uB3D9\uD560 \uACC4\uC815\uC758 ID\uC640 \uBE44\uBC00\uBC88\uD638\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694. ",-1)),a("div",ue,[t(B,{label:S(v)(S(z).ID),filled:"",modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=s=>b.value=s),onBlur:W,onKeyup:G(Q,["enter"]),error:!!T.value,"error-message":T.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),t(B,{label:S(v)(S(z).PASSWORD),filled:"",modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),type:"password",onBlur:U,onKeyup:G(Q,["enter"]),error:!!q.value,"error-message":q.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),$.value?(c(),f(le,{key:0,rounded:"",dense:"",class:"bg-grey-2 text-grey-8 q-mt-sm"},{avatar:l(()=>[t(C,{name:"telegram",color:"primary"})]),default:l(()=>[a("div",de,[e[9]||(e[9]=R(" \uC5F0\uACB0\uD560 \uD154\uB808\uADF8\uB7A8 \uACC4\uC815: ")),a("strong",null,d($.value),1)])]),_:1})):h("",!0),t(P,{color:"primary",unelevated:"",class:"q-mt-md",loading:D.value,disable:D.value,onClick:Q},{default:l(()=>e[10]||(e[10]=[R(" \uD154\uB808\uADF8\uB7A8 \uACC4\uC815 \uC5F0\uB3D9 ")])),_:1},8,["loading","disable"])])]),_:1})]),_:1})),a("div",me,[t(oe,{dense:"","expand-separator":"",icon:"bug_report",label:"Telegram Debug Info (\uAC1C\uBC1C \uC804\uC6A9)","header-class":"bg-grey-3 text-grey-9"},{default:l(()=>[t(p,null,{default:l(()=>[t(y,{class:"text-caption bg-grey-10 text-grey-2"},{default:l(()=>{var s,r;return[a("div",null,"has Telegram.WebApp: "+d(K.value),1),a("div",null,"isTelegramReady: "+d(I.value),1),a("div",null,"linkCompleted: "+d(E.value),1),a("div",null,"initData length: "+d(u.value||0),1),a("div",null,"telegramUser.id: "+d(((s=n.value)==null?void 0:s.id)||"null"),1),a("div",null," telegramUser.username: "+d(((r=n.value)==null?void 0:r.username)||"null"),1),a("div",ve,[e[13]||(e[13]=R(" initData (\uC55E\uBD80\uBD84\uB9CC \uD45C\uC2DC): ")),a("pre",ge,d(J.value),1)])]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}))}};var we=ne(ce,[["__scopeId","data-v-26a62072"]]);export{we as default};
