import{u as Z,r as u,d as k,J as h,e as p,f as y,g as l,a3 as B,h as t,i as a,aR as x,aS as b,aT as G,q as C,t as m,m as z,Q as M,j as S,l as K,n as R,s as ee,L as j}from"./index.03abecc4.js";import{u as ae,Q as te,a as le,b as se,c as re,V as F,v as ne,L as V}from"./QItemLabel.412ec24c.js";import{_ as oe,Q as ue}from"./QExpansionItem.5ab3d109.js";const ie={class:"text-body1 text-negative q-mb-sm"},de={class:"q-gutter-y-md column"},me={class:"text-caption"},ve={class:"q-mt-md"},ce={class:"q-mt-sm"},ge={class:"debug-pre"},fe={__name:"AuthTelegram",setup(pe){const _=ae(),{$t:c}=Z(),U=u(!0),T=u(!1),f=u(""),s=u(null),i=u(""),w=u(""),I=u(""),D=u(""),E=u(""),A=u(!1),Q=u(!1),J=k(()=>typeof window=="undefined"?!1:!!(window.Telegram&&window.Telegram.WebApp)),H=k(()=>i.value?i.value.length>200?i.value.slice(0,200)+"...":i.value:""),W=k(()=>{if(!s.value)return"";const{username:o,first_name:e,last_name:r,id:n}=s.value;return o?`@${o} (ID: ${n})`:e||r?`${e||""} ${r||""} (ID: ${n})`.trim():`ID: ${n}`}),L=()=>w.value.trim()?(D.value="",!0):(D.value=c(F.ID_REQUIRED),!1),P=()=>I.value.trim()?(E.value="",!0):(E.value=c(F.PASSWORD_REQUIRED),!1),X=async()=>{var o,e,r,n,v,q;try{if(typeof window=="undefined"){f.value="\uBE0C\uB77C\uC6B0\uC800 \uD658\uACBD\uC5D0\uC11C\uB9CC \uC811\uADFC \uAC00\uB2A5\uD569\uB2C8\uB2E4.";return}const d=window.Telegram&&window.Telegram.WebApp;if(!d){f.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uAC00 \uAC10\uC9C0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uC774 \uD398\uC774\uC9C0\uB97C \uB2E4\uC2DC \uC5F4\uC5B4\uC8FC\uC138\uC694.";return}try{d.ready()}catch{}if(i.value=d.initData||"",s.value=((o=d.initDataUnsafe)==null?void 0:o.user)||null,!i.value||!((e=s.value)!=null&&e.id)){f.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC815\uBCF4\uAC00 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.";return}try{const g=await B.post("/api/v1/telegram/verify",{initData:i.value,telegramUserId:s.value.id,username:s.value.username,firstName:s.value.first_name,lastName:s.value.last_name}),O=Number((n=(r=g.data)==null?void 0:r.code)!=null?n:0);if(!(((v=g.data)==null?void 0:v.success)===!0||O===200)){f.value=((q=g.data)==null?void 0:q.message)||"\uD154\uB808\uADF8\uB7A8 \uC778\uC99D\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uB098\uC911\uC5D0 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.";return}T.value=!0}catch{f.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC11C\uBC84\uC640 \uD1B5\uC2E0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694."}}finally{U.value=!1}},N=async()=>{var r,n,v,q;if(!T.value||!s.value){_.notify({type:"negative",message:"\uD154\uB808\uADF8\uB7A8 \uC778\uC99D\uC774 \uC644\uB8CC\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."});return}const o=L(),e=P();if(!(!o||!e)){if(!ne(w.value,I.value)){_.notify({type:"negative",message:c(V.ID_PW_REQUIRED)});return}A.value=!0;try{const d=await B.post("/api/v1/telegram/link",{mbrId:w.value,mbrPw:I.value,telegramUserId:s.value.id,username:s.value.username,firstName:s.value.first_name,lastName:s.value.last_name,initData:i.value}),g=Number((n=(r=d.data)==null?void 0:r.code)!=null?n:0);if(!(((v=d.data)==null?void 0:v.success)===!0||g===200)){const $=((q=d.data)==null?void 0:q.message)||c(V.ID_PW_INCORRECT);_.notify({type:"negative",message:$});return}_.notify({type:"positive",message:"\uD154\uB808\uADF8\uB7A8 \uACC4\uC815\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC5F0\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),Q.value=!0}catch{_.notify({type:"negative",message:c(V.SERVER_CONNECTION_FAILED)})}finally{A.value=!1}}},Y=()=>{var o;try{typeof window!="undefined"&&((o=window.Telegram)==null?void 0:o.WebApp)?window.Telegram.WebApp.close():window.close()}catch{window.close()}};return h(()=>{X()}),(o,e)=>(p(),y(te,null,{default:l(()=>[t(re,null,{default:l(()=>[t(le,{class:"q-pa-xl flex flex-center"},{default:l(()=>[e[14]||(e[14]=a("section",{class:"q-mb-lg text-center"},[a("div",{class:"text-h5 text-primary q-mb-xs"},"Telegram \uC778\uC99D"),a("div",{class:"text-subtitle2 text-grey-7"}," \uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uC0AC\uC6A9\uD560 \uC218 \uC788\uB294 \uACC4\uC815 \uC5F0\uB3D9 \uD398\uC774\uC9C0\uC785\uB2C8\uB2E4. ")],-1)),t(x,null,{default:l(()=>[t(b,{class:"flex flex-center column q-pa-xl"},{default:l(()=>[t(G,{color:"primary",size:"32px",class:"q-mb-md"}),e[2]||(e[2]=a("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778\uD558\uAE30 ",-1)),e[3]||(e[3]=a("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})]),_:1}),U.value?(p(),y(x,{key:0,flat:"",bordered:""},{default:l(()=>[t(b,{class:"flex flex-center column q-pa-xl"},{default:l(()=>[t(G,{color:"primary",size:"32px",class:"q-mb-md"}),e[4]||(e[4]=a("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778 \uC911\uC785\uB2C8\uB2E4... ",-1)),e[5]||(e[5]=a("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})]),_:1})):!T.value&&!Q.value?(p(),y(x,{key:1,flat:"",bordered:"",class:"bg-grey-1"},{default:l(()=>[t(b,{class:"flex column items-center q-pa-xl"},{default:l(()=>[t(C,{name:"warning",color:"negative",size:"40px",class:"q-mb-md"}),a("div",ie,m(f.value),1),e[6]||(e[6]=a("div",{class:"text-caption text-grey-7 q-mb-md text-center"}," \uC774 \uD398\uC774\uC9C0\uB294 \uD154\uB808\uADF8\uB7A8 \uBD07\uC5D0\uC11C \uC5F4\uB9AC\uB294 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uB3D9\uC791\uD569\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694. ",-1))]),_:1})]),_:1})):Q.value?(p(),y(x,{key:2,flat:"",bordered:""},{default:l(()=>[t(b,{class:"flex column items-center q-pa-xl"},{default:l(()=>[t(C,{name:"check_circle",color:"positive",size:"40px",class:"q-mb-md"}),e[7]||(e[7]=a("div",{class:"text-h6 q-mb-sm"},"\uD154\uB808\uADF8\uB7A8 \uC5F0\uB3D9\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.",-1)),e[8]||(e[8]=a("div",{class:"text-body2 text-grey-7 q-mb-md text-center"}," \uC774\uC81C \uC774 \uACC4\uC815\uC73C\uB85C \uB85C\uADF8\uC778\uD560 \uB54C \uD154\uB808\uADF8\uB7A8\uC744 \uD1B5\uD574 2\uB2E8\uACC4 \uC778\uC99D \uCF54\uB4DC\uB97C \uBC1B\uC73C\uC2E4 \uC218 \uC788\uC2B5\uB2C8\uB2E4. ",-1)),t(z,{color:"primary",unelevated:"",label:"\uB2EB\uAE30",onClick:Y})]),_:1})]),_:1})):(p(),y(x,{key:3,flat:"",bordered:""},{default:l(()=>[t(b,{class:"q-pa-lg"},{default:l(()=>[e[11]||(e[11]=a("div",{class:"text-subtitle1 q-mb-xs"},"\uACC4\uC815 \uD655\uC778",-1)),e[12]||(e[12]=a("div",{class:"text-caption text-grey-7 q-mb-md"}," \uD154\uB808\uADF8\uB7A8\uC5D0 \uC5F0\uB3D9\uD560 \uACC4\uC815\uC758 ID\uC640 \uBE44\uBC00\uBC88\uD638\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694. ",-1)),a("div",de,[t(M,{label:S(c)(S(j).ID),filled:"",modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=r=>w.value=r),onBlur:L,onKeyup:K(N,["enter"]),error:!!D.value,"error-message":D.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),t(M,{label:S(c)(S(j).PASSWORD),filled:"",modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=r=>I.value=r),type:"password",onBlur:P,onKeyup:K(N,["enter"]),error:!!E.value,"error-message":E.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),W.value?(p(),y(se,{key:0,rounded:"",dense:"",class:"bg-grey-2 text-grey-8 q-mt-sm"},{avatar:l(()=>[t(C,{name:"telegram",color:"primary"})]),default:l(()=>[a("div",me,[e[9]||(e[9]=R(" \uC5F0\uACB0\uD560 \uD154\uB808\uADF8\uB7A8 \uACC4\uC815: ")),a("strong",null,m(W.value),1)])]),_:1})):ee("",!0),t(z,{color:"primary",unelevated:"",class:"q-mt-md",loading:A.value,disable:A.value,onClick:N},{default:l(()=>e[10]||(e[10]=[R(" \uD154\uB808\uADF8\uB7A8 \uACC4\uC815 \uC5F0\uB3D9 ")])),_:1},8,["loading","disable"])])]),_:1})]),_:1})),a("div",ve,[t(ue,{dense:"","expand-separator":"",icon:"bug_report",label:"Telegram Debug Info (\uAC1C\uBC1C \uC804\uC6A9)","header-class":"bg-grey-3 text-grey-9"},{default:l(()=>[t(x,null,{default:l(()=>[t(b,{class:"text-caption bg-grey-10 text-grey-2"},{default:l(()=>{var r,n,v;return[a("div",null,"has Telegram.WebApp: "+m(J.value),1),a("div",null,"isTelegramReady: "+m(T.value),1),a("div",null,"linkCompleted: "+m(Q.value),1),a("div",null,"initData length: "+m(((r=i.value)==null?void 0:r.length)||0),1),a("div",null,"telegramUser.id: "+m(((n=s.value)==null?void 0:n.id)||"null"),1),a("div",null," telegramUser.username: "+m(((v=s.value)==null?void 0:v.username)||"null"),1),a("div",ce,[e[13]||(e[13]=R(" initData (\uC55E\uBD80\uBD84\uB9CC \uD45C\uC2DC): ")),a("pre",ge,m(H.value),1)])]}),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}))}};var _e=oe(fe,[["__scopeId","data-v-1399decc"]]);export{_e as default};
