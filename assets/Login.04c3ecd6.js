import{u as J,r as v,c as Z,w as ee,o as te,d as T,e as D,f as u,g as o,h as r,i as e,j as O,t as s,Q as A,k as b,l as h,m as _,n as M,p as G,q as Q,L as a,s as q}from"./index.162f68b0.js";import{u as ae,a as le,Q as se,b as ne,c as B,d as oe,V as W}from"./QSelect.3ec0233d.js";const re={class:"q-pa-md flex flex-center column",style:{"max-width":"300px","text-align":"center"}},ie={key:0},ue={class:"q-gutter-y-md column",style:{"max-width":"300px"}},de={key:1},ce={class:"q-gutter-y-md column",style:{"max-width":"300px"}},me={class:"text-body2"},ve={class:"text-h6 q-mt-sm q-mb-xs text-center"},_e={class:"text-caption text-center"},pe={class:"text-body2"},ge={class:"text-h6"},fe={key:0,class:"text-caption"},xe={__name:"Login",setup(Ie){const E=ae(),{$t:t}=J(),{login:U,isLoading:d,requiresOtp:C,pendingToken:F,otpMessage:K,otpExpiresIn:$,verifyOtpHandler:z,cancelOtpState:L,remainingAttempts:p,otpError:w}=le(),g=v(""),f=v(""),x=v(""),y=v(""),V=v("N"),c=v(""),i=v(0);let l=null;const H=Z(()=>{const m=Math.floor(i.value/60),n=i.value%60;return`${m}:${n.toString().padStart(2,"0")}`}),Y=()=>{i.value=$.value,l&&clearInterval(l),l=setInterval(()=>{i.value>0?i.value--:(clearInterval(l),j())},1e3)},j=()=>{E.notify({type:"negative",message:t(a.OTP_EXPIRED),timeout:3e3}),R()};ee(C,m=>{m?Y():l&&clearInterval(l)}),te(()=>{l&&clearInterval(l)});const k=()=>g.value.trim()?(x.value="",!0):(x.value=t(W.ID_REQUIRED),!1),P=()=>f.value.trim()?(y.value="",!0):(y.value=t(W.PASSWORD_REQUIRED),!1),N=async()=>{const m=k(),n=P();!m||!n||await U(g.value,f.value,V.value)},X=()=>{E.dialog({title:t(a.LOST_ID_PW_TITLE),message:t(a.CONTACT_ADMIN),html:!0,ok:{label:t(q.CONFIRM),color:"primary"}})},S=async()=>{if(c.value.length!==6){E.notify({type:"warning",message:t(a.ENTER_6_DIGIT_OTP)});return}await z({otpCode:c.value,pendingToken:F.value})&&(l&&(clearInterval(l),l=null),L(),c.value="",i.value=0)},R=()=>{l&&(clearInterval(l),l=null),L(),c.value="",i.value=0,g.value="",f.value="",V.value="N",E.notify({type:"info",message:t(a.OTP_CANCELLED)})};return(m,n)=>(T(),D(se,null,{default:u(()=>[o(oe,null,{default:u(()=>[o(ne,{class:"q-pa-xl flex flex-center"},{default:u(()=>[n[3]||(n[3]=r("section",{class:"q-mb-xl"},null,-1)),r("div",re,[e(C)?(T(),O("div",de,[r("h6",null,s(e(t)(e(a).TWO_FACTOR_AUTH)),1),r("div",ce,[o(B,{class:M([i.value<=60?"bg-negative":"bg-info","text-white"]),rounded:""},{default:u(()=>[r("div",me,s(e(K)),1),r("div",ve,[o(G,{name:"schedule",size:"24px",class:"q-mr-xs"}),_(" "+s(H.value),1)]),r("div",_e,s(i.value<=60?e(t)(e(a).TIME_WARNING):e(t)(e(a).REMAINING_TIME)),1)]),_:1},8,["class"]),o(A,{label:e(t)(e(a).OTP_CODE_LABEL),filled:"",modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=I=>c.value=I),mask:"######",maxlength:"6",onKeyup:b(S,["enter"]),"input-class":"text-center text-h5",hint:e(t)(e(a).OTP_CODE_HINT),disable:i.value===0,error:!!e(w),"error-message":e(w)},null,8,["label","modelValue","hint","disable","error","error-message"]),e(p)!==null&&e(p)<=3?(T(),D(B,{key:0,class:M([e(p)===1?"bg-negative":"bg-warning","text-white"]),rounded:"",dense:""},{avatar:u(()=>[o(G,{name:"warning"})]),default:u(()=>[r("div",pe,[r("strong",null,s(e(t)(e(a).WARNING)),1),_(" "+s(e(t)(e(a).REMAINING_ATTEMPTS))+" ",1),r("span",ge,s(e(p))+s(e(t)(e(a).ATTEMPTS_UNIT)),1)]),e(p)===1?(T(),O("div",fe,s(e(t)(e(a).LAST_ATTEMPT_WARNING)),1)):Q("",!0)]),_:1},8,["class"])):Q("",!0),o(h,{color:"primary",onClick:S,loading:e(d),disable:e(d)||c.value.length!==6||i.value===0,size:"md"},{default:u(()=>[_(s(e(d)?e(t)(e(a).VERIFYING):e(t)(e(a).VERIFY)),1)]),_:1},8,["loading","disable"]),o(h,{color:"grey",outline:"",onClick:R,disable:e(d)},{default:u(()=>[_(s(e(t)(e(q).CANCEL)),1)]),_:1},8,["disable"])])])):(T(),O("div",ie,[r("h6",null,s(e(t)(e(a).WELCOME)),1),r("div",ue,[o(A,{label:e(t)(e(a).ID),filled:"",modelValue:g.value,"onUpdate:modelValue":n[0]||(n[0]=I=>g.value=I),onKeyup:b(N,["enter"]),onBlur:k,error:!!x.value,"error-message":x.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),o(A,{label:e(t)(e(a).PASSWORD),filled:"",modelValue:f.value,"onUpdate:modelValue":n[1]||(n[1]=I=>f.value=I),type:"password",onKeyup:b(N,["enter"]),onBlur:P,error:!!y.value,"error-message":y.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),o(h,{color:"primary",onClick:N,loading:e(d),disable:e(d)},{default:u(()=>[_(s(e(d)?e(t)(e(a).LOGGING_IN):e(t)(e(a).LOGIN)),1)]),_:1},8,["loading","disable"]),o(h,{color:"info",onClick:X},{default:u(()=>[_(s(e(t)(e(a).LOST_ID_PW)),1)]),_:1})])]))])]),_:1})]),_:1})]),_:1}))}};export{xe as default};
