import{u as j,r as l,d as S,a1 as H,e as c,f as w,g as o,F as N,h as r,i as s,aR as J,aS as T,aT as X,q as $,t as L,m as P,Q as O,j as q,l as U,k as Y,n as W,s as Z,L as B}from"./index.34a1bd31.js";import{u as h,Q as ee,a as ae,b as te,V as G,v as le,L as k}from"./user.ea1d5d9f.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";const re={class:"text-body1 text-negative q-mb-sm text-center"},ne={class:"q-gutter-y-md column"},oe={key:0,class:"text-caption text-grey-7"},ue={__name:"AuthTelegram",setup(ie){const f=h(),{$t:d}=j(),C=l(!0),x=l(!1),n=l(""),u=l(null),v=l(""),g=l(""),p=l(""),_=l(""),b=l(""),I=l(!1),D=l(!1);S(()=>typeof window=="undefined"?!1:!!(window.Telegram&&window.Telegram.WebApp)),S(()=>v.value?v.value.length>200?v.value.slice(0,200)+"...":v.value:"");const Q=S(()=>{if(!u.value)return"";const{username:t,first_name:e,last_name:a,id:i}=u.value;return t?`@${t} (ID: ${i})`:e||a?`${e||""} ${a||""} (ID: ${i})`.trim():`ID: ${i}`}),R=()=>g.value.trim()?(_.value="",!0):(_.value=d(G.ID_REQUIRED),!1),V=()=>p.value.trim()?(b.value="",!0):(b.value=d(G.PASSWORD_REQUIRED),!1),M=async()=>{var t;try{if(typeof window=="undefined"){n.value="\uBE0C\uB77C\uC6B0\uC800 \uD658\uACBD\uC5D0\uC11C\uB9CC \uC811\uADFC \uAC00\uB2A5\uD569\uB2C8\uB2E4.";return}const e=window.Telegram&&window.Telegram.WebApp;if(!e){n.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uAC00 \uAC10\uC9C0\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uC774 \uD398\uC774\uC9C0\uB97C \uB2E4\uC2DC \uC5F4\uC5B4\uC8FC\uC138\uC694.";return}const a=e.initData||"";if(v.value=a,u.value=((t=e.initDataUnsafe)==null?void 0:t.user)||null,!a){n.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC815\uBCF4\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4.";return}const i=await N.get("/api/v1/telegram/verify",{params:{initData:a}}),{valid:E,message:y,user:m}=i.data||{};if(E===!0)x.value=!0,n.value="",window.alert(`\uD154\uB808\uADF8\uB7A8 \uC811\uC18D \uAC80\uC99D: \uC131\uACF5

${y||""}${m?`
user: ${m}`:""}`);else{x.value=!1,n.value=y||"\uD154\uB808\uADF8\uB7A8 \uC778\uC571\uC774 \uC544\uB2CC \uACBD\uB85C\uC5D0\uC11C \uC811\uC18D\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",window.alert(`\uD154\uB808\uADF8\uB7A8 \uC811\uC18D \uAC80\uC99D: \uC2E4\uD328

${n.value}`);return}}catch{n.value="\uD154\uB808\uADF8\uB7A8 \uC778\uC99D \uC11C\uBC84\uC640 \uD1B5\uC2E0\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.",window.alert(`\uD154\uB808\uADF8\uB7A8 \uC811\uC18D \uAC80\uC99D \uC911 \uC11C\uBC84 \uC624\uB958

${n.value}`)}finally{C.value=!1}},A=async()=>{var a,i,E,y;if(!x.value||!u.value){f.notify({type:"negative",message:"\uD154\uB808\uADF8\uB7A8 \uC778\uC99D\uC774 \uC644\uB8CC\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."});return}const t=R(),e=V();if(!(!t||!e)){if(!le(g.value,p.value)){f.notify({type:"negative",message:d(k.ID_PW_REQUIRED)});return}I.value=!0;try{const m=await N.post("/api/v1/telegram/link",{mbrId:g.value,mbrPw:p.value,telegramUserId:u.value.id,username:u.value.username,firstName:u.value.first_name,lastName:u.value.last_name,initData:v.value}),K=Number((i=(a=m.data)==null?void 0:a.code)!=null?i:0);if(!(((E=m.data)==null?void 0:E.success)===!0||K===200)){const F=((y=m.data)==null?void 0:y.message)||d(k.ID_PW_INCORRECT);f.notify({type:"negative",message:F});return}f.notify({type:"positive",message:"\uD154\uB808\uADF8\uB7A8 \uACC4\uC815\uC774 \uC131\uACF5\uC801\uC73C\uB85C \uC5F0\uB3D9\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),D.value=!0}catch{f.notify({type:"negative",message:d(k.SERVER_CONNECTION_FAILED)})}finally{I.value=!1}}},z=()=>{var t;try{typeof window!="undefined"&&((t=window.Telegram)==null?void 0:t.WebApp)?window.Telegram.WebApp.close():window.close()}catch{window.close()}};return H(()=>{M()}),(t,e)=>(c(),w(ee,null,{default:o(()=>[r(te,null,{default:o(()=>[r(ae,{class:"q-pa-xl flex flex-center"},{default:o(()=>[e[9]||(e[9]=s("section",{class:"q-mb-lg text-center"},[s("div",{class:"text-h5 text-primary q-mb-xs"},"Telegram \uC778\uC99D"),s("div",{class:"text-subtitle2 text-grey-7"}," \uD154\uB808\uADF8\uB7A8 \uC778\uC571 \uC6F9\uBDF0\uC5D0\uC11C\uB9CC \uC0AC\uC6A9\uD560 \uC218 \uC788\uB294 \uACC4\uC815 \uC5F0\uB3D9 \uD398\uC774\uC9C0\uC785\uB2C8\uB2E4. ")],-1)),r(J,{flat:"",bordered:""},{default:o(()=>[C.value?(c(),w(T,{key:0,class:"flex flex-center column q-pa-xl"},{default:o(()=>[r(X,{color:"primary",size:"32px",class:"q-mb-md"}),e[2]||(e[2]=s("div",{class:"text-body1 q-mb-xs"}," \uD154\uB808\uADF8\uB7A8 \uD658\uACBD\uC744 \uD655\uC778 \uC911\uC785\uB2C8\uB2E4... ",-1)),e[3]||(e[3]=s("div",{class:"text-caption text-grey-7"},"\uC7A0\uC2DC\uB9CC \uAE30\uB2E4\uB824\uC8FC\uC138\uC694.",-1))]),_:1})):!x.value&&!D.value?(c(),w(T,{key:1,class:"flex column items-center q-pa-xl"},{default:o(()=>[r($,{name:"warning",color:"negative",size:"40px",class:"q-mb-md"}),s("div",re,L(n.value||"\uD154\uB808\uADF8\uB7A8 \uC571\uC5D0\uC11C \uB2E4\uC2DC \uC5F4\uC5B4\uC8FC\uC138\uC694."),1)]),_:1})):D.value?(c(),w(T,{key:2,class:"flex column items-center q-pa-xl"},{default:o(()=>[r($,{name:"check_circle",color:"positive",size:"40px",class:"q-mb-md"}),e[4]||(e[4]=s("div",{class:"text-h6 q-mb-sm"},"\uD154\uB808\uADF8\uB7A8 \uC5F0\uB3D9\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4.",-1)),r(P,{color:"primary",unelevated:"",label:"\uB2EB\uAE30",onClick:z,class:"q-mt-sm"})]),_:1})):(c(),w(T,{key:3,class:"q-pa-lg"},{default:o(()=>[e[7]||(e[7]=s("div",{class:"text-subtitle1 q-mb-xs"},"\uACC4\uC815 \uD655\uC778",-1)),e[8]||(e[8]=s("div",{class:"text-caption text-grey-7 q-mb-md"}," \uD154\uB808\uADF8\uB7A8\uC5D0 \uC5F0\uB3D9\uD560 \uACC4\uC815\uC758 ID\uC640 \uBE44\uBC00\uBC88\uD638\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694. ",-1)),s("div",ne,[r(O,{label:q(d)(q(B).ID),filled:"",modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),onBlur:R,onKeyup:U(A,["enter"]),error:!!_.value,"error-message":_.value},null,8,["label","modelValue","error","error-message"]),r(O,{label:q(d)(q(B).PASSWORD),filled:"",modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value=a),type:"password",onBlur:V,onKeyup:U(A,["enter"]),error:!!b.value,"error-message":b.value},null,8,["label","modelValue","error","error-message"]),Q.value?(c(),Y("div",oe,[e[5]||(e[5]=W(" \uD154\uB808\uADF8\uB7A8 \uACC4\uC815: ")),s("strong",null,L(Q.value),1)])):Z("",!0),r(P,{color:"primary",unelevated:"",class:"q-mt-md",loading:I.value,disable:I.value,onClick:A},{default:o(()=>e[6]||(e[6]=[W(" \uD154\uB808\uADF8\uB7A8 \uACC4\uC815 \uC5F0\uB3D9 ")])),_:1},8,["loading","disable"])])]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1}))}};var fe=se(ue,[["__scopeId","data-v-005fd39f"]]);export{fe as default};
