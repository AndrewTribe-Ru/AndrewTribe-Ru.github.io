import{c as ee,u as te,r as v,d as ae,w as le,o as se,e as T,f as D,g as u,h as n,i as r,j as e,k as A,t as o,Q as O,l as b,m as E,n as _,p as M,q as G,s as q,L as a,v as Q}from"./index.acaefd83.js";import{u as oe,Q as ne,a as re,b as B,c as ie,V as W}from"./QItemLabel.0d5197b8.js";import{u as ue}from"./QSelect.9c1ef29f.js";const de={class:"q-pa-md flex flex-center column",style:{"max-width":"300px","text-align":"center"}},ce={key:0},me={class:"q-gutter-y-md column",style:{"max-width":"300px"}},ve={key:1},_e={class:"q-gutter-y-md column",style:{"max-width":"300px"}},pe={class:"text-body2"},ge={class:"text-h6 q-mt-sm q-mb-xs text-center"},fe={class:"text-caption text-center"},Ie={class:"text-body2"},Te={class:"text-h6"},Ee={key:0,class:"text-caption"},Ae={__name:"Login",setup(xe){const x=oe(),U=ee(),{$t:t}=te(),{login:F,isLoading:d,requiresOtp:C,pendingToken:K,otpMessage:$,otpExpiresIn:z,verifyOtpHandler:H,cancelOtpState:L,remainingAttempts:p,otpError:w}=ue(),Y=()=>{U.push("/auth/telegram")},g=v(""),f=v(""),y=v(""),h=v(""),k=v("N"),c=v(""),i=v(0);let l=null;const j=ae(()=>{const m=Math.floor(i.value/60),s=i.value%60;return`${m}:${s.toString().padStart(2,"0")}`}),X=()=>{i.value=z.value,l&&clearInterval(l),l=setInterval(()=>{i.value>0?i.value--:(clearInterval(l),J())},1e3)},J=()=>{x.notify({type:"negative",message:t(a.OTP_EXPIRED),timeout:3e3}),S()};le(C,m=>{m?X():l&&clearInterval(l)}),se(()=>{l&&clearInterval(l)});const V=()=>g.value.trim()?(y.value="",!0):(y.value=t(W.ID_REQUIRED),!1),P=()=>f.value.trim()?(h.value="",!0):(h.value=t(W.PASSWORD_REQUIRED),!1),N=async()=>{const m=V(),s=P();!m||!s||await F(g.value,f.value,k.value)},Z=()=>{x.dialog({title:t(a.LOST_ID_PW_TITLE),message:t(a.CONTACT_ADMIN),html:!0,ok:{label:t(Q.CONFIRM),color:"primary"}})},R=async()=>{if(c.value.length!==6){x.notify({type:"warning",message:t(a.ENTER_6_DIGIT_OTP)});return}await H({otpCode:c.value,pendingToken:K.value})&&(l&&(clearInterval(l),l=null),L(),c.value="",i.value=0)},S=()=>{l&&(clearInterval(l),l=null),L(),c.value="",i.value=0,g.value="",f.value="",k.value="N",x.notify({type:"info",message:t(a.OTP_CANCELLED)})};return(m,s)=>(T(),D(ne,null,{default:u(()=>[n(ie,null,{default:u(()=>[n(re,{class:"q-pa-xl flex flex-center"},{default:u(()=>[s[4]||(s[4]=r("section",{class:"q-mb-xl"},null,-1)),r("div",de,[e(C)?(T(),A("div",ve,[r("h6",null,o(e(t)(e(a).TWO_FACTOR_AUTH)),1),r("div",_e,[n(B,{class:M([i.value<=60?"bg-negative":"bg-info","text-white"]),rounded:""},{default:u(()=>[r("div",pe,o(e($)),1),r("div",ge,[n(G,{name:"schedule",size:"24px",class:"q-mr-xs"}),_(" "+o(j.value),1)]),r("div",fe,o(i.value<=60?e(t)(e(a).TIME_WARNING):e(t)(e(a).REMAINING_TIME)),1)]),_:1},8,["class"]),n(O,{label:e(t)(e(a).OTP_CODE_LABEL),filled:"",modelValue:c.value,"onUpdate:modelValue":s[2]||(s[2]=I=>c.value=I),mask:"######",maxlength:"6",onKeyup:b(R,["enter"]),"input-class":"text-center text-h5",hint:e(t)(e(a).OTP_CODE_HINT),disable:i.value===0,error:!!e(w),"error-message":e(w)},null,8,["label","modelValue","hint","disable","error","error-message"]),e(p)!==null&&e(p)<=3?(T(),D(B,{key:0,class:M([e(p)===1?"bg-negative":"bg-warning","text-white"]),rounded:"",dense:""},{avatar:u(()=>[n(G,{name:"warning"})]),default:u(()=>[r("div",Ie,[r("strong",null,o(e(t)(e(a).WARNING)),1),_(" "+o(e(t)(e(a).REMAINING_ATTEMPTS))+" ",1),r("span",Te,o(e(p))+o(e(t)(e(a).ATTEMPTS_UNIT)),1)]),e(p)===1?(T(),A("div",Ee,o(e(t)(e(a).LAST_ATTEMPT_WARNING)),1)):q("",!0)]),_:1},8,["class"])):q("",!0),n(E,{color:"primary",onClick:R,loading:e(d),disable:e(d)||c.value.length!==6||i.value===0,size:"md"},{default:u(()=>[_(o(e(d)?e(t)(e(a).VERIFYING):e(t)(e(a).VERIFY)),1)]),_:1},8,["loading","disable"]),n(E,{color:"grey",outline:"",onClick:S,disable:e(d)},{default:u(()=>[_(o(e(t)(e(Q).CANCEL)),1)]),_:1},8,["disable"])])])):(T(),A("div",ce,[r("h6",null,o(e(t)(e(a).WELCOME)),1),r("div",me,[n(O,{label:e(t)(e(a).ID),filled:"",modelValue:g.value,"onUpdate:modelValue":s[0]||(s[0]=I=>g.value=I),onKeyup:b(N,["enter"]),onBlur:V,error:!!y.value,"error-message":y.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),n(O,{label:e(t)(e(a).PASSWORD),filled:"",modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=I=>f.value=I),type:"password",onKeyup:b(N,["enter"]),onBlur:P,error:!!h.value,"error-message":h.value,"bottom-slots":""},null,8,["label","modelValue","error","error-message"]),n(E,{color:"primary",onClick:N,loading:e(d),disable:e(d)},{default:u(()=>[_(o(e(d)?e(t)(e(a).LOGGING_IN):e(t)(e(a).LOGIN)),1)]),_:1},8,["loading","disable"]),n(E,{color:"info",onClick:Z},{default:u(()=>[_(o(e(t)(e(a).LOST_ID_PW)),1)]),_:1}),n(E,{color:"secondary",outline:"",class:"q-mt-sm",onClick:Y},{default:u(()=>s[3]||(s[3]=[_(" Telegram \uC778\uC99D \uC5F0\uB3D9 ")])),_:1})])]))])]),_:1})]),_:1})]),_:1}))}};export{Ae as default};
